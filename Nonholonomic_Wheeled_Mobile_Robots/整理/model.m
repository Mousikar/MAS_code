clear all; clc; close all;
randn('seed',1)%1
luf=0;
N1=6000;
I1=609;I2=659;I3=401;
w0=0.0667;
A=zeros(6);
A(1,2)=1;
A(3,4)=1;
A(5,6)=1;
A(2,1)=4*w0^2*(I3-I2)/I1;
A(2,6)=-w0*(I2-I3-I1)/I1;
A(4,3)=3*w0^2*(I3-I1)/I2;
A(6,2)=w0*(I2-I1-I3)/I3;
A(6,5)=w0^2*(I1-I2)/I3;
Bn0=zeros(6,3);
Bn0(2,1)=1/I1;
Bn0(4,2)=1/I2;
Bn0(6,3)=1/I3;

%安装矩阵
U=[sqrt(3)/3 -sqrt(3)/3 sqrt(3)/3 -sqrt(3)/3;
    -sqrt(3)/3 -sqrt(3)/3 sqrt(3)/3 sqrt(3)/3;
    sqrt(3)/3 sqrt(3)/3 sqrt(3)/3 sqrt(3)/3];
B=Bn0*U;
C=eye(6);
% C=[1 0 0 0 0 0; 0 0 1 0 0 0; 0 0 0 0 1 0; 0 0 0 0 0 1];
D=zeros(size(C,1),size(B,2));
Bv=eye(size(A,1));
Dw=eye(6);

lu=size(B,2);
ly=size(C,1);
lx=size(A,1);
lf=lu+ly;

%设置噪声标准差
v1c=1e-4;
v2c=1e-4;
v3c=1e-4;
v4c=1e-4;
v5c=1e-4;
v6c=1e-4;

w1c=5*10^(-3);
w2c=3*10^(-2);
w3c=5*10^(-3);
w4c=3*10^(-2);
w5c=5*10^(-3);
w6c=3*10^(-2);


%生成噪声
v1_star1=v1c*randn(1,N1); 
v2_star1=v2c*randn(1,N1);
v3_star1=v3c*randn(1,N1);
v4_star1=v4c*randn(1,N1);
v5_star1=v5c*randn(1,N1);
v6_star1=v6c*randn(1,N1);
v=[v1_star1;v2_star1;v3_star1;v4_star1;v5_star1;v6_star1];
w1=w1c*randn(1,N1);
w2=w2c*randn(1,N1);
w3=w3c*randn(1,N1);
w4=w4c*randn(1,N1);
w5=w5c*randn(1,N1);
w6=w6c*randn(1,N1);
w=[w1;w2;w3;w4;w5;w6];


x(:,1)=[0;30;40;1;0;2];
% y0(:,1)=C*x(:,1);
dt=0.1;
%控制输入
K=1e3*[-2.3330   -2.7517    2.5213    2.9828   -1.5301   -1.8198
    2.3241    2.7615    2.5209    2.9828   -1.5394   -1.8103
   -2.3338   -2.7514   -2.5213   -2.9828   -1.5307   -1.8202
    2.3250    2.7612   -2.5209   -2.9828   -1.5388   -1.8099];
K=1e3*[2.3331    2.7516   -2.5209   -2.9826    1.5306    1.8199
   -2.3243   -2.7615   -2.5214   -2.9830    1.5389    1.8102
    2.3337    2.7514    2.5209    2.9826    1.5302    1.8200
   -2.3248   -2.7613    2.5214    2.9830    1.5393    1.8100];
% K=1e3*[0.6617    0.9256   -0.5191   -0.8045    0.3458    0.5108;
%        -0.8533   -1.1158   -0.6961   -0.9815    0.3458    0.5311;
%         0.8533    1.1171    0.6961    0.9815    0.3458    0.5108;
%        -0.6617   -0.9242    0.5191    0.8045    0.3458    0.5311];
%系统离散化
[~,B]=c2d(A,B,dt);
[A,Bv]=c2d(A,Bv,dt);
y0=zeros(size(C,1),N1);
u1=zeros(4,N1);

for i=1:N1
    u1(:,i)=-K*x(:,i);
    x(:,i+1)=A*x(:,i)+B*u1(:,i);
    y0(:,i)=C*x(:,i)+D*u1(:,i);
end
